<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>生成应用脚手架学习 - Cynqu</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Cynqu"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Cynqu"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="开发node cli脚手架"><meta property="og:type" content="blog"><meta property="og:title" content="生成应用脚手架学习"><meta property="og:url" content="http://example.com/2021/04/27/%E7%94%9F%E6%88%90%E5%BA%94%E7%94%A8%E8%84%9A%E6%89%8B%E6%9E%B6%E5%AD%A6%E4%B9%A0/"><meta property="og:site_name" content="Cynqu"><meta property="og:description" content="开发node cli脚手架"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://example.com/img/apass.jpg"><meta property="article:published_time" content="2021-04-27T08:26:55.000Z"><meta property="article:modified_time" content="2021-04-28T08:40:43.227Z"><meta property="article:author" content="Cynqu"><meta property="article:tag" content="框架"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/apass.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com/2021/04/27/%E7%94%9F%E6%88%90%E5%BA%94%E7%94%A8%E8%84%9A%E6%89%8B%E6%9E%B6%E5%AD%A6%E4%B9%A0/"},"headline":"生成应用脚手架学习","image":["http://example.com/img/apass.jpg"],"datePublished":"2021-04-27T08:26:55.000Z","dateModified":"2021-04-28T08:40:43.227Z","author":{"@type":"Person","name":"Cynqu"},"description":"开发node cli脚手架"}</script><link rel="canonical" href="http://example.com/2021/04/27/%E7%94%9F%E6%88%90%E5%BA%94%E7%94%A8%E8%84%9A%E6%89%8B%E6%9E%B6%E5%AD%A6%E4%B9%A0/"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="Cynqu" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="/img/apass.jpg" alt="生成应用脚手架学习"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><a class="link-muted" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a><span> / </span><a class="link-muted" href="/categories/%E5%89%8D%E7%AB%AF/%E6%A1%86%E6%9E%B6/">框架</a></span><span class="level-item">26 分钟读完 (大约3848个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">生成应用脚手架学习</h1><div class="content"><h1 id="一、基础学习-开发node-cli脚手架流程"><a href="#一、基础学习-开发node-cli脚手架流程" class="headerlink" title="一、基础学习 开发node cli脚手架流程"></a>一、基础学习 开发node cli脚手架流程</h1><h2 id="1、-工具准备"><a href="#1、-工具准备" class="headerlink" title="1、 工具准备"></a>1、 工具准备</h2><p>初始化 npm init -y 创建package.json</p>
<p>修改package.json加入常用依赖包</p>
<p>自动初始化一个项目的流程主要是以下三点：</p>
<ul>
<li>读取用户配置</li>
<li>读取模板文件</li>
<li>根据配置，编译模板文件，输出最终文件</li>
</ul>
<p>所需常用依赖：</p>
<h3 id="（1）配置信息工具"><a href="#（1）配置信息工具" class="headerlink" title="（1）配置信息工具"></a>（1）配置信息工具</h3><h4 id="commander"><a href="#commander" class="headerlink" title="commander"></a>commander</h4><p>一个帮助快速开发Nodejs命令行工具的package</p>
<ul>
<li><strong>version</strong></li>
</ul>
<p>定义版本号</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> program = <span class="built_in">require</span>(<span class="string">&#x27;commander&#x27;</span>);</span><br><span class="line"> </span><br><span class="line">program</span><br><span class="line">    .version(<span class="string">&#x27;0.0.1&#x27;</span>)</span><br><span class="line">    .parse(process.argv);</span><br><span class="line">    <span class="comment">//添加参数解析</span></span><br><span class="line">#执行结果：</span><br><span class="line">node index.js -V</span><br><span class="line"> </span><br><span class="line"><span class="number">0.0</span><span class="number">.1</span></span><br><span class="line">#如果希望程序响应-v选项而不是-V选项，</span><br><span class="line">#只需使用与option方法相同的语法将自定义标志传递给version方法</span><br><span class="line">program</span><br><span class="line">  .version(<span class="string">&#x27;0.0.1&#x27;</span>, <span class="string">&#x27;-v, --version&#x27;</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>option</strong><ul>
<li>使用**.option()<strong>方法定义</strong>commander<strong>的选项</strong>options**</li>
<li>示例：.option(‘-n, –name <items1> [items2]’, ‘name description’, ‘default value’)</li>
<li>参数解析：<ol>
<li>自定义标志&lt;必须&gt;：分为长短标识，中间用逗号、竖线或者空格分割；标志后面可跟必须参数或可选参数，前者用<code>&lt;&gt;</code>包含，后者用<code>[]</code>包含</li>
<li>选项描述&lt;省略不报错&gt;：在使用 –help 命令时显示标志描述</li>
<li>默认值&lt;可省略&gt;</li>
<li>短标志可以作为单独的参数传递。像 -abc 等于 -a -b -c。多词组成的选项，像“–template-engine”会变成 program.templateEngine 等。</li>
</ol>
</li>
</ul>
</li>
<li><strong>command</strong><ul>
<li>作用：添加命令名称</li>
<li>示例：<code>.command(&#39;add &lt;num&gt;[otherDirs...]&#39;, &#39;install description&#39;, opts)</code></li>
<li>参数解析：<ol>
<li>命令名称&lt;必须&gt;：命令后面可跟用 &lt;&gt; 或 [] 包含的参数；命令的最后一个参数可以是可变的，像实例中那样在数组后面加入 … 标志；在命令后面传入的参数会被传入到 action 的回调函数以及 program.args 数组中</li>
<li>命令描述&lt;可省略&gt;：如果存在，且没有显示调用action(fn)，就会启动子命令程序，否则会报错</li>
<li>配置选项&lt;可省略&gt;：可配置noHelp、isDefault等</li>
</ol>
</li>
</ul>
</li>
<li><strong>alias description usage</strong></li>
</ul>
<p>定义命令的别名 描述和用法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.alias(<span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">.usage(<span class="string">&#x27;[options] &lt;file ...&gt;&#x27;</span>)</span><br><span class="line">.description(<span class="string">&#x27;run setup commands for all envs&#x27;</span>)</span><br><span class="line">#output</span><br><span class="line">gp-cli rm --help</span><br><span class="line">Usage: rm|r [options] &lt;file ...&gt;</span><br><span class="line">run setup commands <span class="keyword">for</span> all envs</span><br><span class="line">Options:</span><br><span class="line">  -r, --recursive     Remove recursively</span><br><span class="line">  -d --drink [drink]  Drink</span><br><span class="line">  -h, --help          output usage information</span><br></pre></td></tr></table></figure>
<h4 id="inquirer"><a href="#inquirer" class="headerlink" title="inquirer"></a>inquirer</h4><p>inquirer为NodeJs做一个可嵌入式的美观的命令行界面</p>
<p>Inquirer.js仅仅给用户提供了一个漂亮的界面和提出问题流的方式。</p>
<p>它是非常容易去处理以下几种事情的：</p>
<ul>
<li>提供错误回调</li>
<li>询问操作者问题</li>
<li>获取并解析用户输入</li>
<li>检测用户回答是否合法</li>
<li>管理多层级的提示</li>
</ul>
<p>inquirer为每个问题提供很多参数：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123; </span><br><span class="line">  type: String, // 表示提问的类型，下文会单独解释 </span><br><span class="line">  name: String, // 在最后获取到的answers回答对象中，作为当前这个问题的键</span><br><span class="line">  message: String|Function, // 打印出来的问题标题，如果为函数的话 </span><br><span class="line">  default: String|Number|Array|Function, // 用户不输入回答时，问题的默认值。或者使用函数来return一个默认值。假如为函数时，函数第一个参数为当前问题的输入答案。 </span><br><span class="line">  choices: Array|Function, // 给出一个选择的列表，假如是一个函数的话，第一个参数为当前问题的输入答案。为数组时，数组的每个元素可以为基本类型中的值。 </span><br><span class="line">  validate: Function, // 接受用户输入，并且当值合法时，函数返回true。当函数返回false时，一个默认的错误信息会被提供给用户。 </span><br><span class="line">  filter: Function, // 接受用户输入并且将值转化后返回填充入最后的answers对象内。 </span><br><span class="line">  when: Function|Boolean, // 接受当前用户输入的answers对象，并且通过返回true或者false来决定是否当前的问题应该去问。也可以是简单类型的值。 </span><br><span class="line">  pageSize: Number, // 改变渲染list,rawlist,expand或者checkbox时的行数的长度。</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>语法结构</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const inquirer &#x3D; require(&#39;inquirer&#39;);</span><br><span class="line">const promptList &#x3D; [</span><br><span class="line">    &#x2F;&#x2F; 具体交互内容</span><br><span class="line">];</span><br><span class="line">inquirer.prompt(promptList).then(answers &#x3D;&gt; &#123;</span><br><span class="line">    console.log(answers); &#x2F;&#x2F; 返回的结果</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li>
<li><p>input</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promptList = [&#123;</span><br><span class="line">    type: <span class="string">&#x27;input&#x27;</span>,</span><br><span class="line">    message: <span class="string">&#x27;设置一个用户名:&#x27;</span>,</span><br><span class="line">    name: <span class="string">&#x27;name&#x27;</span>,</span><br><span class="line">    <span class="keyword">default</span>: <span class="string">&quot;test_user&quot;</span> <span class="comment">// 默认值</span></span><br><span class="line">&#125;,&#123;</span><br><span class="line">    type: <span class="string">&#x27;input&#x27;</span>,</span><br><span class="line">    message: <span class="string">&#x27;请输入手机号:&#x27;</span>,</span><br><span class="line">    name: <span class="string">&#x27;phone&#x27;</span>,</span><br><span class="line">    validate: <span class="function"><span class="keyword">function</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(val.match(<span class="regexp">/\d&#123;11&#125;/g</span>)) &#123; <span class="comment">// 校验位数</span></span><br><span class="line">            <span class="keyword">return</span> val;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;请输入11位数字&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<p>效果：<br><img src="https://uploader.shimo.im/f/xYZpK8Tm0EPCD1a4.png!thumbnail?fileGuid=rdPR3Dhhv6j6VY9C" alt="图片"></p>
</li>
<li><p>comfirm</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promptList = [&#123;</span><br><span class="line">    type: <span class="string">&quot;confirm&quot;</span>,</span><br><span class="line">    message: <span class="string">&quot;是否使用监听？&quot;</span>,</span><br><span class="line">    name: <span class="string">&quot;watch&quot;</span>,</span><br><span class="line">    prefix: <span class="string">&quot;前缀&quot;</span></span><br><span class="line">&#125;,&#123;</span><br><span class="line">    type: <span class="string">&quot;confirm&quot;</span>,</span><br><span class="line">    message: <span class="string">&quot;是否进行文件过滤？&quot;</span>,</span><br><span class="line">    name: <span class="string">&quot;filter&quot;</span>,</span><br><span class="line">    suffix: <span class="string">&quot;后缀&quot;</span>,</span><br><span class="line">    when: <span class="function"><span class="keyword">function</span>(<span class="params">answers</span>) </span>&#123; <span class="comment">// 当watch为true的时候才会提问当前问题</span></span><br><span class="line">        <span class="keyword">return</span> answers.watch</span><br><span class="line">    &#125;</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<p>效果：<br><img src="https://uploader.shimo.im/f/twOVrHA0QFENBJjU.png!thumbnail?fileGuid=rdPR3Dhhv6j6VY9C" alt="图片"></p>
</li>
<li><p>list</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promptList = [&#123;</span><br><span class="line">    type: <span class="string">&#x27;list&#x27;</span>,</span><br><span class="line">    message: <span class="string">&#x27;请选择一种水果:&#x27;</span>,</span><br><span class="line">    name: <span class="string">&#x27;fruit&#x27;</span>,</span><br><span class="line">    choices: [</span><br><span class="line">        <span class="string">&quot;Apple&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Pear&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Banana&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    filter: <span class="function"><span class="keyword">function</span> (<span class="params">val</span>) </span>&#123; <span class="comment">// 使用filter将回答变为小写</span></span><br><span class="line">        <span class="keyword">return</span> val.toLowerCase();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<p>效果：<br><img src="https://uploader.shimo.im/f/6ByuWJWCA83Wg1bj.png!thumbnail?fileGuid=rdPR3Dhhv6j6VY9C" alt="图片"></p>
</li>
<li><p>expand</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promptList = [&#123;</span><br><span class="line">    type: <span class="string">&quot;expand&quot;</span>,</span><br><span class="line">    message: <span class="string">&quot;请选择一种水果：&quot;</span>,</span><br><span class="line">    name: <span class="string">&quot;fruit&quot;</span>,</span><br><span class="line">    choices: [</span><br><span class="line">        &#123;</span><br><span class="line">            key: <span class="string">&quot;a&quot;</span>,</span><br><span class="line">            name: <span class="string">&quot;Apple&quot;</span>,</span><br><span class="line">            value: <span class="string">&quot;apple&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            key: <span class="string">&quot;O&quot;</span>,</span><br><span class="line">            name: <span class="string">&quot;Orange&quot;</span>,</span><br><span class="line">            value: <span class="string">&quot;orange&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            key: <span class="string">&quot;p&quot;</span>,</span><br><span class="line">            name: <span class="string">&quot;Pear&quot;</span>,</span><br><span class="line">            value: <span class="string">&quot;pear&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<p>效果：<br><img src="https://uploader.shimo.im/f/MVGtNTGQyw3Sd8jy.png!thumbnail?fileGuid=rdPR3Dhhv6j6VY9C" alt="图片"></p>
</li>
<li><p>password</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promptList = [&#123;</span><br><span class="line">    type: <span class="string">&quot;password&quot;</span>, <span class="comment">// 密码为密文输入</span></span><br><span class="line">    message: <span class="string">&quot;请输入密码：&quot;</span>,</span><br><span class="line">    name: <span class="string">&quot;pwd&quot;</span></span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<p>效果：<br><img src="https://uploader.shimo.im/f/CBdZcRJ6iXwKKaUA.png!thumbnail?fileGuid=rdPR3Dhhv6j6VY9C" alt="图片"></p>
</li>
<li><p>editor</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promptList = [&#123;</span><br><span class="line">    type: <span class="string">&quot;editor&quot;</span>,</span><br><span class="line">    message: <span class="string">&quot;请输入备注：&quot;</span>,</span><br><span class="line">    name: <span class="string">&quot;editor&quot;</span></span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<p>效果：<br><img src="https://uploader.shimo.im/f/XkG2bYBKIs29wI4O.png!thumbnail?fileGuid=rdPR3Dhhv6j6VY9C" alt="图片"></p>
</li>
</ul>
<h3 id="（2）模板信息工具"><a href="#（2）模板信息工具" class="headerlink" title="（2）模板信息工具"></a>（2）模板信息工具</h3><h4 id="mem-fs-amp-mem-fs-editor"><a href="#mem-fs-amp-mem-fs-editor" class="headerlink" title="mem-fs &amp; mem-fs-editor"></a><strong>mem-fs &amp; mem-fs-editor</strong></h4><p><strong>mem-fs &amp; mem-fs-editor</strong>提供了一系列API，方便操作模板文件。mem-fs是对文件进行读取，存入内存中</p>
<ul>
<li>读写文件</li>
</ul>
<p>**read(filepath, [options])**：将文件内容作为string返回。options.raw = true可以返回文件原始内容buffer。文件不存在会报错，如果你不想用try-catch，可以设置options.defaults返回默认值，这样就不会报错了。</p>
<p>**readJSON(filepath, [defaults])**：读JSON</p>
<p>**write(filepath, contents)**：写文件</p>
<p>**writeJSON(filepath, contents[, replacer [, space]])**：写JSON</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> memFs = <span class="built_in">require</span>(<span class="string">&quot;mem-fs&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> editor = <span class="built_in">require</span>(<span class="string">&quot;mem-fs-editor&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> store = memFs.create();</span><br><span class="line"><span class="keyword">const</span> fs = editor.create(store);</span><br><span class="line"><span class="keyword">const</span> srcFile = path.resolve(__dirname, <span class="string">&#x27;../tmp/data2.txt&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> srcJson = path.resolve(__dirname, <span class="string">&#x27;../../package.json&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> destTpl = path.resolve(__dirname, <span class="string">&#x27;../tmp/dataMemFs.tpl&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> destJson = path.resolve(__dirname, <span class="string">&#x27;../tmp/dataMemFs.json&#x27;</span>);</span><br><span class="line">fs.read(srcFile);                                   <span class="comment">// hello world!</span></span><br><span class="line">fs.read(srcFile, &#123; <span class="attr">raw</span>: <span class="literal">true</span> &#125;);                    <span class="comment">// &lt;Buffer 68 65 6c 6c 6f 20 77 6f 72 6c 64 21&gt;</span></span><br><span class="line">fs.read(<span class="string">&#x27;somefile.txt&#x27;</span>, &#123; <span class="attr">defaults</span>: <span class="string">&#x27;文件不存在&#x27;</span> &#125;);  <span class="comment">// 文件不存在</span></span><br><span class="line">fs.readJSON(srcJson);   <span class="comment">// json对象</span></span><br><span class="line">fs.write(destTpl, <span class="string">&quot;&lt;%= value %%gt;&quot;</span>);</span><br><span class="line">fs.writeJSON(destJson, <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(&#123; <span class="attr">name</span>: <span class="string">&quot;tool-demo&quot;</span> &#125;)));</span><br></pre></td></tr></table></figure>
<ul>
<li>改删文件</li>
</ul>
<p>**append(filepath, contents, [options])**：文件末添加新内容，options.trimEnd默认为true，options.separator新旧内容间的分隔符，默认EOL</p>
<p>**extendJSON(filepath, contents[, replacer [, space]])**：JSON文件末添加新内容</p>
<p>**delete(filepath, [options])**：删文件或文件夹</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fs.append(destTpl, <span class="string">&quot;&lt;%= value2 %&gt;&quot;</span>, &#123; <span class="attr">separator</span>: <span class="string">&#x27;\r\n----\r\n&#x27;</span> &#125;);</span><br><span class="line">fs.extendJSON(destJson, <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(&#123; <span class="attr">description</span>: <span class="string">&quot;some tool demo&quot;</span> &#125;)));</span><br><span class="line">fs.delete(destJson);</span><br></pre></td></tr></table></figure>
<ul>
<li>拷贝、移动文件</li>
</ul>
<p>**copy(from, to, [options], context[, templateOptions ])**：拷贝文件</p>
<p>**copyTpl(from, to, context[, templateOptions [, copyOptions]])**：拷贝模板</p>
<p>**move(from, to, [options])**：移动文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fs.copy(destTpl, path.join(__dirname, <span class="string">&#x27;../tmp/mem-fs/dataMemFs.tpl&#x27;</span>));</span><br><span class="line">fs.copyTpl(destTpl, path.join(__dirname, <span class="string">&#x27;../tmp/mem-fs/dataMemFs.txt&#x27;</span>), &#123;</span><br><span class="line">    value: <span class="number">1</span>,</span><br><span class="line">    value2: <span class="number">2</span></span><br><span class="line">&#125;);</span><br><span class="line">fs.move(path.join(__dirname, <span class="string">&#x27;../tmp/mem-fs/dataMemFs.tpl&#x27;</span>), destTpl);</span><br></pre></td></tr></table></figure>
<ul>
<li>其他</li>
</ul>
<p>**exists(filepath)**：文件是否存在</p>
<p>**commit([filters,] callback)**：将内存中的文件操作全部提交到磁盘上</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fs.exists(destTpl);    <span class="comment">// true</span></span><br><span class="line">fs.commit(<span class="function">() =&gt;</span> &#123;&#125;);             <span class="comment">// 同步</span></span><br><span class="line">fs.commit(<span class="function">() =&gt;</span> &#123; resolve(); &#125;); <span class="comment">// 异步</span></span><br></pre></td></tr></table></figure>
<h3 id="（3）提示信息工具"><a href="#（3）提示信息工具" class="headerlink" title="（3）提示信息工具"></a><strong>（3）</strong>提示信息工具</h3><h4 id="chalk"><a href="#chalk" class="headerlink" title="chalk"></a>chalk</h4><p><strong>chalk</strong>包的作用是修改控制台中字符串的样式，包括：</p>
<ol>
<li>字体样式(加粗、隐藏等)</li>
<li>字体颜色</li>
<li>背景颜色</li>
</ol>
<p><strong>chalk</strong>支持两种方式使用：常规的调用方式和模板中使用的方式。</p>
<ul>
<li>常规使用<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> chalk = <span class="built_in">require</span>(<span class="string">&#x27;chalk&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(chalk.red.bold.bgWhite(<span class="string">&#x27;Hello World&#x27;</span>));</span><br></pre></td></tr></table></figure>
上面代码执行的结果是，Hello World 加粗，字体颜色是红色，背景颜色是白色。<br>注意：背景颜色要在 bg 后面加上具体的颜色，颜色的第一个字母大写。</li>
</ul>
<p>在 HTML 中支持 RGB 颜色，在这里同样支持，而且是支持所有 HTML 中支持的颜色，如十六进制颜色。这里仅仅说明十六进制颜色。</p>
<p>下面的代码会和上面的代码实现相同的效果。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> chalk = <span class="built_in">require</span>(<span class="string">&#x27;chalk&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(chalk.rgb(<span class="number">255</span>,<span class="number">0</span>,<span class="number">0</span>).bold.bgRgb(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>)(<span class="string">&#x27;Hello World&#x27;</span>));</span><br></pre></td></tr></table></figure>
<ul>
<li>模板使用</li>
</ul>
<p>该模块有一个好的地方，就是支持模板输出，也就是说，不管在字符串中的哪个位置想改变输出的颜色，都是可以的。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> chalk = <span class="built_in">require</span>(<span class="string">&#x27;chalk&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(chalk<span class="string">`&#123;red.bold.bgWhite Hello World&#125;`</span>);</span><br></pre></td></tr></table></figure>
<p>当然，也可以使用 RGB 颜色值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> chalk = <span class="built_in">require</span>(<span class="string">&#x27;chalk&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(chalk<span class="string">`&#123;rgb(255,0,0).bold.bgRgb(255,255,255) Hello World&#125;`</span>);</span><br></pre></td></tr></table></figure>
<h3 id="（4）文件操作"><a href="#（4）文件操作" class="headerlink" title="（4）文件操作"></a>（4）文件操作</h3><h4 id="fs-extra"><a href="#fs-extra" class="headerlink" title="fs-extra"></a>fs-extra</h4><p><a target="_blank" rel="noopener" href="https://github.com/jprichardson/node-fs-extra?fileGuid=rdPR3Dhhv6j6VY9C">fs-extra</a>是更方便的fs包，用于处理各种文件，支持fs中的所有方法，项目中只用fs-extra就行了。当然如果你实在要用fs，两个一起用也没问题：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> fse = <span class="built_in">require</span>(<span class="string">&#x27;fs-extra&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>fs-extra中的方法，默认都是异步的，返回promise</p>
<ul>
<li>copy</li>
<li>move(src, dest, [options, callback])，移动文件或文件夹。</li>
<li>remove(path, [callback])，删除文件或文件夹，类似rm -rf</li>
<li>emptyDiremptyDir(dir, [callback])，清空目录中的文件。如果目录不存在，就创建一个空目录。</li>
<li>ensureFile，ensureDir</li>
</ul>
<p>ensureFile(file, [callback])，确保文件存在。如果文件不存在，就创建这些目录，并创建空文件。如果文件已经存在，不修改它。</p>
<p>ensureDir(dir[,options][,callback])，确保文件夹存在。如果文件夹不存在，就创建，等价于：mkdir -p。</p>
<ul>
<li>ensureLink，ensureSymlink</li>
</ul>
<p>ensureLink(srcpath, dstpath, [callback])，确保link存在。如果文件夹不存在，就创建。</p>
<p>ensureSymlink(srcpath, dstpath, [type, callback])，确保symlink存在。如果文件夹不存在，就创建。</p>
<ul>
<li>outputFile，outputJson</li>
</ul>
<p>outputFile(file, data, [options, callback])，类似fs.writeFile()，写文件，会直接覆盖文件。如果文件不存在会创建。</p>
<p>outputJson(file, object, [options, callback])，类似fs.writeJson()，写文件，会直接覆盖文件。如果文件不存在会创建。</p>
<ul>
<li>pathExistspathExists(file[, callback])，判断路径是否存在，类似fs.exists。</li>
<li>readJson，writeJson</li>
</ul>
<p>readJson(file, [options, callback])，读取Json文件，并转成object。</p>
<p>writeJson(file, object, [options, callback])，将object写入Json文件。</p>
<p><strong>copy</strong></p>
<ul>
<li>copy(src, dest, [options, callback])</li>
</ul>
<p>如果src是目录，将拷贝目录下所有文件。如果src是文件，dest不能是目录。</p>
<ul>
<li>options：</li>
</ul>
<p>overwrite：bool，默认true</p>
<p>errorOnExist：bool，默认false，当为false且dest存在时抛出异常</p>
<p>dereference：bool，默认false</p>
<p>preserveTimestamps：bool，默认false</p>
<p>filter：function，过滤需要拷贝的文件，返回true为include，返回false为exclude</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs-extra&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> SRC = path.resolve(__dirname, <span class="string">&#x27;..&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> DEST = path.join(__dirname, <span class="string">&#x27;/tmp&#x27;</span>);</span><br><span class="line">fs.copy(<span class="string">`<span class="subst">$&#123;SRC&#125;</span>/chalk.js`</span>, <span class="string">`<span class="subst">$&#123;DEST&#125;</span>/chalk.js`</span>, <span class="function"><span class="params">err</span> =&gt;</span> &#123;    <span class="comment">// 拷贝文件（用 callback）</span></span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;success!&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">fs.copy(<span class="string">`<span class="subst">$&#123;SRC&#125;</span>/inquirer`</span>, <span class="string">`<span class="subst">$&#123;DEST&#125;</span>/inquirer`</span>, <span class="function"><span class="params">err</span> =&gt;</span> &#123;    <span class="comment">// 拷贝文件夹</span></span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;success!&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">fs.copy(<span class="string">`<span class="subst">$&#123;SRC&#125;</span>/execa.js`</span>, <span class="string">`<span class="subst">$&#123;DEST&#125;</span>/execa.js`</span>)             <span class="comment">// 拷贝文件（用 promise）</span></span><br><span class="line">    .then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;success!&#x27;</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.error(err);</span><br><span class="line">    &#125;);</span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">example</span> (<span class="params"></span>) </span>&#123;                                <span class="comment">// 拷贝文件（用 async/await）</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> fs.copy(<span class="string">`<span class="subst">$&#123;SRC&#125;</span>/listr.js`</span>, <span class="string">`<span class="subst">$&#123;DEST&#125;</span>/listr.js`</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;success!&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.error(err);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">example();</span><br><span class="line"><span class="keyword">const</span> filterFunc = <span class="function">(<span class="params">src, dest</span>) =&gt;</span> &#123;                        <span class="comment">// 用过滤器</span></span><br><span class="line">    <span class="keyword">return</span> <span class="regexp">/list/</span>.test(src);  <span class="comment">// 为 true 才拷贝</span></span><br><span class="line">&#125;;</span><br><span class="line">fs.copy(<span class="string">`<span class="subst">$&#123;SRC&#125;</span>/listr.js`</span>, <span class="string">`<span class="subst">$&#123;DEST&#125;</span>/listr.js`</span>, &#123; <span class="attr">filter</span>: filterFunc &#125;, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;success!&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="download-git-repo"><a href="#download-git-repo" class="headerlink" title="download-git-repo"></a>download-git-repo</h4><p>download(repository, destination, options, callback)</p>
<ul>
<li><strong>repository</strong></li>
</ul>
<p>使用 clone 时，路径</p>
<p>GitHub - github:owner/name or simply owner/name</p>
<p>GitLab - gitlab:owner/name</p>
<p>Bitbucket - bitbucket:owner/name</p>
<p>后面也可以用 # 添加分支</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">  download(MAIN_GIT_REPO, downloadPath, &#123; <span class="attr">clone</span>: <span class="literal">true</span> &#125;, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        downloadSpinner.color = <span class="string">&#x27;red&#x27;</span>;</span><br><span class="line">        downloadSpinner.fail(err.message);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      downloadSpinner.color = <span class="string">&#x27;green&#x27;</span>;</span><br><span class="line">      downloadSpinner.succeed(<span class="string">&#x27;下载成功&#x27;</span>);</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">let</span> i =<span class="number">0</span>;i&lt;components.length;i++)&#123;</span><br><span class="line">        <span class="keyword">let</span> name = components[i];</span><br><span class="line">        <span class="keyword">const</span> component = getComponentConfig(<span class="built_in">this</span>.config.module,name);</span><br><span class="line">        <span class="keyword">const</span> copyFiles = getDirFileName(downloadPath);</span><br><span class="line">        <span class="keyword">const</span> src = path.join(downloadPath, component.src);</span><br><span class="line">        fse.copySync(src, path.join(component.des));</span><br><span class="line">        downloadSpinner.succeed(<span class="string">&#x27;复制文件成功&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      fse.remove(downloadPath);</span><br><span class="line">    &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(e)</span><br><span class="line">    &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">      fse.remove(downloadPath);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<h2 id="2、实现"><a href="#2、实现" class="headerlink" title="2、实现"></a>2、实现</h2><h3 id="新建执行文件"><a href="#新建执行文件" class="headerlink" title="新建执行文件"></a>新建执行文件</h3><p>新建文件夹<code>bin</code>,并在文件夹下新建名称为${自定义指令}的shell脚本文件（注意：不能有后缀名）。</p>
<p>shell脚本文件内容如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env node</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;hello world&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>其中，<code>#!/usr/bin/env node</code>是告诉编译器，以<code>node</code>的方式，运行代码。<br>并在<code>package.json</code>加入以下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;bin&quot;: &#123;</span><br><span class="line">    &quot;npg&quot;: &quot;bin&#x2F;npg&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>增加额外指令，可直接在bin文件夹下增加对应文件：<br>指令lxq test</p>
<p>可增加lxq-test.js文件</p>
<p>此时代码结构</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">npm-package-cli</span><br><span class="line">        |-- bin</span><br><span class="line">            |-- npg</span><br><span class="line">            |-- npg-test.js</span><br><span class="line">            |-- npg-init.js</span><br><span class="line">        |-- package.json</span><br></pre></td></tr></table></figure>
<h3 id="链接指令到全局"><a href="#链接指令到全局" class="headerlink" title="链接指令到全局"></a>链接指令到全局</h3><p>链接指令有两种方式：</p>
<ul>
<li><strong>npm link</strong></li>
<li><strong>npm install -g</strong></li>
</ul>
<p>两种方式，都需要在<code>npm-package-cli</code>文件夹下运行，才能生效。</p>
<p>作用是把<code>npg</code>指令，指向全局的<code>bin</code>文件下，实现软链。</p>
<h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3><p>在任意文件夹下运行命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npg</span><br><span class="line"># 输出</span><br><span class="line">hello world</span><br></pre></td></tr></table></figure>
<h3 id="初始化操作类"><a href="#初始化操作类" class="headerlink" title="初始化操作类"></a>初始化操作类</h3><p>操作类的作用是整合所有操作，并提供接口给对应指令文件</p>
<p>以init指令为例</p>
<p>在src下新建init指令对应的操作类project.js文件，结构如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Project</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.config = <span class="built_in">Object</span>.assign(&#123;</span><br><span class="line">    projectName: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    description: <span class="string">&#x27;&#x27;</span></span><br><span class="line">  &#125;, options);</span><br><span class="line">  <span class="keyword">const</span> store = memFs.create();</span><br><span class="line">  <span class="built_in">this</span>.memFsEditor = editor.create(store);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//初始化函数</span></span><br><span class="line">Project.prototype.create = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">//与用户交互后获取参数</span></span><br><span class="line">  <span class="comment">//这里inquirer.prompt方法装载好要收集的问题后，返回的是Promise对象。收集完成之后，要在then方法内拿到配置信息，以便进行下一步模板替换的操作。</span></span><br><span class="line">  <span class="built_in">this</span>.inquire()</span><br><span class="line">    .then(<span class="function">(<span class="params">answer</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.config = <span class="built_in">Object</span>.assign(<span class="built_in">this</span>.config, answer);</span><br><span class="line">      <span class="comment">//获取参数后调用执行函数</span></span><br><span class="line">      <span class="built_in">this</span>.generate();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//用户交互，获取用户配置信息</span></span><br><span class="line">Project.prototype.inquire = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="keyword">const</span> prompts = [];</span><br><span class="line">   <span class="comment">//像prompts 中添加与用户交互的信息</span></span><br><span class="line">   <span class="keyword">return</span> inquirer.prompt(prompts);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//执行代码</span></span><br><span class="line">Project.prototype.generate = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">//当前指令的执行代码</span></span><br><span class="line">&#125;；</span><br><span class="line"><span class="built_in">module</span>.exports = Project;</span><br></pre></td></tr></table></figure>
<h3 id="修改npg-init指令文件"><a href="#修改npg-init指令文件" class="headerlink" title="修改npg-init指令文件"></a>修改npg-init指令文件</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env node</span></span><br><span class="line"><span class="keyword">const</span> program = <span class="built_in">require</span>(<span class="string">&#x27;commander&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> Project = <span class="built_in">require</span>(<span class="string">&#x27;../src/project&#x27;</span>);</span><br><span class="line"><span class="comment">//利用commander配置指令选项</span></span><br><span class="line">program</span><br><span class="line">  .option(<span class="string">&#x27;--name [name]&#x27;</span>, <span class="string">&#x27;项目名称&#x27;</span>)</span><br><span class="line">  .option(<span class="string">&#x27;--desc [description]&#x27;</span>, <span class="string">&#x27;项目介绍&#x27;</span>)</span><br><span class="line">  .parse(process.argv);</span><br><span class="line"><span class="keyword">const</span> &#123; name, description &#125; = program;</span><br><span class="line"><span class="keyword">const</span> args = program.args;</span><br><span class="line"><span class="keyword">const</span> projectName = args[<span class="number">0</span>] || name;</span><br><span class="line"><span class="keyword">const</span> project = <span class="keyword">new</span> Project(&#123;</span><br><span class="line">  projectName,</span><br><span class="line">  description</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//调用执行类初始化函数</span></span><br><span class="line">project.create();</span><br></pre></td></tr></table></figure>
<h3 id="模板文件替换输出"><a href="#模板文件替换输出" class="headerlink" title="模板文件替换输出"></a>模板文件替换输出</h3><p>模板文件替换，要用到工具<code>mem-fs</code>和<code>mem-fs-editor</code>。</p>
<p>模板替换函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 模板替换</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>source 源文件路径</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>dest 目标文件路径</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;object&#125;</span> </span>data 替换文本字段</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Project.prototype.injectTemplate = <span class="function"><span class="keyword">function</span>(<span class="params">source, dest, data</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.memFsEditor.copyTpl(</span><br><span class="line">    source,</span><br><span class="line">    dest,</span><br><span class="line">    data</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//处理函数中增加模板替换</span></span><br><span class="line">Project.prototype.generate = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 获取用户配置信息</span></span><br><span class="line">  <span class="keyword">const</span> &#123; projectName, description &#125; = <span class="built_in">this</span>.config;</span><br><span class="line">  <span class="comment">// 当前项目地址</span></span><br><span class="line">  <span class="keyword">const</span> projectPath = path.join(process.cwd(), projectName);</span><br><span class="line">  <span class="comment">// 下载文件暂存地址</span></span><br><span class="line">  <span class="keyword">const</span> downloadPath = path.join(projectPath, <span class="string">&#x27;__download__&#x27;</span>);</span><br><span class="line">  <span class="comment">// 下载加载提示。。。</span></span><br><span class="line">  <span class="keyword">const</span> downloadSpinner = ora(<span class="string">&#x27;正在下载模板，请稍等...&#x27;</span>);</span><br><span class="line">  downloadSpinner.start();</span><br><span class="line">  <span class="comment">// 下载git repo</span></span><br><span class="line">  download(TEMPLATE_GIT_REPO, downloadPath, &#123; <span class="attr">clone</span>: <span class="literal">true</span> &#125;, </span><br><span class="line">  (err) =&gt;&#123;</span><br><span class="line">    <span class="comment">// 复制文件 （除了package.json 直接使用同步拷贝copySync）</span></span><br><span class="line">    <span class="comment">// 主要使用fs-extra 同步复制文件</span></span><br><span class="line">    <span class="keyword">const</span> copyFiles = getDirFileName(downloadPath);</span><br><span class="line">    copyFiles.forEach(<span class="function">(<span class="params">file</span>) =&gt;</span> &#123;</span><br><span class="line">      fse.copySync(path.join(downloadPath, file), </span><br><span class="line">      path.join(projectPath, file));</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;chalk.green(<span class="string">&#x27;✔ &#x27;</span>)&#125;</span><span class="subst">$&#123;chalk.grey(<span class="string">`创建: <span class="subst">$&#123;projectName&#125;</span>/<span class="subst">$&#123;file&#125;</span>`</span>)&#125;</span>`</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//  package.json使用模板替换 将productName、description进行替换</span></span><br><span class="line">    INJECT_FILES.forEach(<span class="function">(<span class="params">file</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.injectTemplate(path.join(downloadPath, file), </span><br><span class="line">      path.join(projectName, file), &#123;</span><br><span class="line">        projectName,</span><br><span class="line">        description</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//这里最重要的一步，是调用mem-fs-editor的方法后，要执行mem-fs-editor的commit方法，输出内存中的文件到硬盘上。</span></span><br><span class="line">    <span class="built_in">this</span>.memFsEditor.commit(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">//输出提示，输出内存中的文件到硬盘上，git初始化等操作</span></span><br><span class="line">      、、、</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;）；</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="3、-小结"><a href="#3、-小结" class="headerlink" title="3、 小结"></a>3、 小结</h2><p>自动初始化一个项目的流程不外乎以下三点：</p>
<ul>
<li>读取用户配置</li>
<li>读取模板文件</li>
<li>根据配置，编译模板文件，输出最终文件</li>
</ul>
<p>命令行工具，是对这三点的有效整合，串连成一个规范的流程。</p>
<h1 id="二、best-cli解析"><a href="#二、best-cli解析" class="headerlink" title="二、best-cli解析"></a>二、best-cli解析</h1><h2 id="1、支持指令"><a href="#1、支持指令" class="headerlink" title="1、支持指令"></a>1、支持指令</h2><p>指令入口文件best:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> program = <span class="built_in">require</span>(<span class="string">&#x27;commander&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; logPackageVersion &#125; = <span class="built_in">require</span>(<span class="string">&#x27;../src/utils&#x27;</span>);</span><br><span class="line">logPackageVersion();</span><br><span class="line"><span class="comment">//定义了如下指令功能</span></span><br><span class="line">program</span><br><span class="line">  .usage(<span class="string">&#x27;&lt;command&gt; [options]&#x27;</span>)</span><br><span class="line">  .command(<span class="string">&#x27;init [name]&#x27;</span>, <span class="string">&#x27;init a project&#x27;</span>)</span><br><span class="line">  .command(<span class="string">&#x27;merge [name]&#x27;</span>, <span class="string">&#x27;merge a project&#x27;</span>)</span><br><span class="line">  .command(<span class="string">&#x27;copy [name]&#x27;</span>, <span class="string">&#x27;copy a component&#x27;</span>)</span><br><span class="line">  .command(<span class="string">&#x27;copymodule [name]&#x27;</span>, <span class="string">&#x27;copy a module&#x27;</span>)</span><br><span class="line">  .command(<span class="string">&#x27;update&#x27;</span>, <span class="string">&#x27;update project&#x27;</span>)</span><br><span class="line">  .command(<span class="string">&#x27;copytools&#x27;</span>, <span class="string">&#x27;copy tools&#x27;</span>)</span><br><span class="line">  .parse(process.argv);</span><br></pre></td></tr></table></figure>
<h2 id="2、常用指令解析"><a href="#2、常用指令解析" class="headerlink" title="2、常用指令解析"></a>2、常用指令解析</h2><h3 id="init"><a href="#init" class="headerlink" title="init"></a>init</h3><p>参照标题一中实现流程</p>
<h3 id="copy"><a href="#copy" class="headerlink" title="copy"></a>copy</h3><p>主要解析操作类文件 copy.js</p>
<p>主要流程同标题一中实现流程，主要解析<strong>generate</strong>函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">Copy.prototype.generate = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 项目执行环境路径</span></span><br><span class="line">  <span class="keyword">const</span> projectPath = path.join(process.cwd(), <span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="comment">//获取复制组件名称，支持多个“,”隔开</span></span><br><span class="line">  <span class="keyword">let</span> components = <span class="built_in">this</span>.config.name.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> i =<span class="number">0</span>;i&lt;components.length;i++)&#123;</span><br><span class="line">    <span class="keyword">let</span> name = components[i];</span><br><span class="line">    <span class="comment">//组件配置库中找到该组件</span></span><br><span class="line">    <span class="keyword">const</span> component = getComponentConfig(<span class="built_in">this</span>.config.module,name);</span><br><span class="line">    <span class="keyword">if</span>(!component)&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;chalk.red(<span class="string">&#x27;x &#x27;</span>)&#125;</span>组件配置不存在`</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 拷贝文件暂存地址</span></span><br><span class="line">  <span class="keyword">const</span> downloadPath = path.join(projectPath, <span class="string">&#x27;__download__&#x27;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> downloadSpinner = ora(<span class="string">&#x27;正在下载组件代码，请稍等...&#x27;</span>);</span><br><span class="line">  downloadSpinner.start();</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 下载git repo</span></span><br><span class="line">  download(MAIN_GIT_REPO, downloadPath, &#123; <span class="attr">clone</span>: <span class="literal">true</span> &#125;, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        downloadSpinner.color = <span class="string">&#x27;red&#x27;</span>;</span><br><span class="line">        downloadSpinner.fail(err.message);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      downloadSpinner.color = <span class="string">&#x27;green&#x27;</span>;</span><br><span class="line">      downloadSpinner.succeed(<span class="string">&#x27;下载成功&#x27;</span>);</span><br><span class="line">      <span class="comment">// 遍历需要复制组件</span></span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">let</span> i =<span class="number">0</span>;i&lt;components.length;i++)&#123;</span><br><span class="line">        <span class="keyword">let</span> name = components[i];</span><br><span class="line">        <span class="keyword">const</span> component = getComponentConfig(<span class="built_in">this</span>.config.module,name);</span><br><span class="line">        <span class="keyword">const</span> src = path.join(downloadPath, component.src);</span><br><span class="line">        <span class="comment">// 从暂存路径中拷贝文件到项目对应路径下</span></span><br><span class="line">        fse.copySync(src, path.join(component.des));</span><br><span class="line">        downloadSpinner.succeed(<span class="string">&#x27;复制文件成功&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 移除暂存文件</span></span><br><span class="line">      fse.remove(downloadPath);</span><br><span class="line">    &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(e)</span><br><span class="line">    &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">      fse.remove(downloadPath);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<h3 id="copymodule"><a href="#copymodule" class="headerlink" title="copymodule"></a>copymodule</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">CopyModule.prototype.generate = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> projectPath = path.join(process.cwd(), <span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> downloadPath = path.join(projectPath, <span class="string">&#x27;__download__&#x27;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> downloadSpinner = ora(<span class="string">&#x27;正在下载模块代码，请稍等...&#x27;</span>);</span><br><span class="line">  downloadSpinner.start();</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 下载git repo</span></span><br><span class="line">  download(MAIN_GIT_REPO, downloadPath, &#123; <span class="attr">clone</span>: <span class="literal">true</span>&#125;, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        downloadSpinner.color = <span class="string">&#x27;red&#x27;</span>;</span><br><span class="line">        downloadSpinner.fail(err.message);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      downloadSpinner.color = <span class="string">&#x27;green&#x27;</span>;</span><br><span class="line">      downloadSpinner.succeed(<span class="string">&#x27;下载成功&#x27;</span>);</span><br><span class="line">      <span class="comment">// 复制文件</span></span><br><span class="line">      <span class="comment">// 遍历组件配置文件中该模块，将该模块下组件批量拷贝</span></span><br><span class="line">      COMPOENTS.forEach(<span class="function">(<span class="params">element</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(element.module === <span class="built_in">this</span>.config.name)&#123;</span><br><span class="line">          element.list.forEach(<span class="function">(<span class="params">item</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(item.src)&#123;</span><br><span class="line">              fse.copySync(path.join(downloadPath, item.src), path.join(item.des));</span><br><span class="line">              downloadSpinner.succeed(<span class="string">`复制组件<span class="subst">$&#123;item.name&#125;</span>成功`</span>);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">      downloadSpinner.succeed(<span class="string">&#x27;复制模块成功&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(e)</span><br><span class="line">    &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">      fse.remove(downloadPath);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure></div><div class="article-licensing box"><div class="licensing-title"><p>生成应用脚手架学习</p><p><a href="http://example.com/2021/04/27/生成应用脚手架学习/">http://example.com/2021/04/27/生成应用脚手架学习/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>Cynqu</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2021-04-27</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2021-04-28</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a class="icon" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a><a class="icon" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/%E6%A1%86%E6%9E%B6/">框架</a></div><div class="notification is-danger">You need to set <code>install_url</code> to use ShareThis. Please set it in <code>_config.yml</code>.</div></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button donate" href="/" target="_blank" rel="noopener" data-type="afdian"><span class="icon is-small"><i class="fas fa-charging-station"></i></span><span>爱发电</span></a><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>支付宝</span><span class="qrcode"><img src="/" alt="支付宝"></span></a><a class="button donate" href="/" target="_blank" rel="noopener" data-type="buymeacoffee"><span class="icon is-small"><i class="fas fa-coffee"></i></span><span>送我杯咖啡</span></a><a class="button donate" href="/" target="_blank" rel="noopener" data-type="patreon"><span class="icon is-small"><i class="fab fa-patreon"></i></span><span>Patreon</span></a><div class="notification is-danger">You forgot to set the <code>business</code> or <code>currency_code</code> for Paypal. Please set it in <code>_config.yml</code>.</div><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="/" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2021/04/27/The%20Cure/"><span class="level-item">The Cure!</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div class="notification is-danger">You forgot to set the <code>shortname</code> for Disqus. Please set it in <code>_config.yml</code>.</div></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-160x160 mx-auto mb-2"><img class="avatar" src="/img/avatar.png" alt="Cynqu"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Cynqu</p><p class="is-size-6 is-block">To The Sky</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">10</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">7</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">6</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/Cynqu" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/Cynqu"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="weibo" href="https://m.weibo.cn/u/2122503823"><i class="fab fa-weibo"></i></a></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-04-27T08:26:55.000Z">2021-04-27</time></p><p class="title"><a href="/2021/04/27/%E7%94%9F%E6%88%90%E5%BA%94%E7%94%A8%E8%84%9A%E6%89%8B%E6%9E%B6%E5%AD%A6%E4%B9%A0/">生成应用脚手架学习</a></p><p class="categories"><a href="/categories/%E5%89%8D%E7%AB%AF/">前端</a> / <a href="/categories/%E5%89%8D%E7%AB%AF/%E6%A1%86%E6%9E%B6/">框架</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-04-27T07:57:48.000Z">2021-04-27</time></p><p class="title"><a href="/2021/04/27/The%20Cure/">The Cure!</a></p><p class="categories"><a href="/categories/%E9%9F%B3%E4%B9%90/">音乐</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-04-27T07:22:03.000Z">2021-04-27</time></p><p class="title"><a href="/2021/04/27/Three-js%E5%88%9D%E6%8E%A2/">Three.js初探</a></p><p class="categories"><a href="/categories/%E5%89%8D%E7%AB%AF/">前端</a> / <a href="/categories/%E5%89%8D%E7%AB%AF/ThreeJs/">ThreeJs</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-04-27T07:18:44.000Z">2021-04-27</time></p><p class="title"><a href="/2021/04/27/%E5%A4%A7%E6%96%87%E4%BB%B6%E5%88%86%E7%89%87%E4%B8%8A%E4%BC%A0%E7%AE%80%E6%98%93%E7%89%88/">大文件分片上传简易版</a></p><p class="categories"><a href="/categories/%E5%89%8D%E7%AB%AF/">前端</a> / <a href="/categories/%E5%89%8D%E7%AB%AF/JavaScript/">JavaScript</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-04-27T07:00:17.000Z">2021-04-27</time></p><p class="title"><a href="/2021/04/27/express%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">express学习笔记</a></p><p class="categories"><a href="/categories/%E5%89%8D%E7%AB%AF/">前端</a> / <a href="/categories/%E5%89%8D%E7%AB%AF/node/">node</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2021/04/"><span class="level-start"><span class="level-item">四月 2021</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3 is-sticky"><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="100%" height="86" src="//music.163.com/outchain/player?type=2&amp;id=21969945&amp;auto=0&amp;height=66"></iframe><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#一、基础学习-开发node-cli脚手架流程"><span class="level-left"><span class="level-item">1</span><span class="level-item">一、基础学习 开发node cli脚手架流程</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#1、-工具准备"><span class="level-left"><span class="level-item">1.1</span><span class="level-item">1、 工具准备</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#（1）配置信息工具"><span class="level-left"><span class="level-item">1.1.1</span><span class="level-item">（1）配置信息工具</span></span></a></li><li><a class="level is-mobile" href="#（2）模板信息工具"><span class="level-left"><span class="level-item">1.1.2</span><span class="level-item">（2）模板信息工具</span></span></a></li><li><a class="level is-mobile" href="#（3）提示信息工具"><span class="level-left"><span class="level-item">1.1.3</span><span class="level-item">（3）提示信息工具</span></span></a></li><li><a class="level is-mobile" href="#（4）文件操作"><span class="level-left"><span class="level-item">1.1.4</span><span class="level-item">（4）文件操作</span></span></a></li></ul></li><li><a class="level is-mobile" href="#2、实现"><span class="level-left"><span class="level-item">1.2</span><span class="level-item">2、实现</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#新建执行文件"><span class="level-left"><span class="level-item">1.2.1</span><span class="level-item">新建执行文件</span></span></a></li><li><a class="level is-mobile" href="#链接指令到全局"><span class="level-left"><span class="level-item">1.2.2</span><span class="level-item">链接指令到全局</span></span></a></li><li><a class="level is-mobile" href="#运行"><span class="level-left"><span class="level-item">1.2.3</span><span class="level-item">运行</span></span></a></li><li><a class="level is-mobile" href="#初始化操作类"><span class="level-left"><span class="level-item">1.2.4</span><span class="level-item">初始化操作类</span></span></a></li><li><a class="level is-mobile" href="#修改npg-init指令文件"><span class="level-left"><span class="level-item">1.2.5</span><span class="level-item">修改npg-init指令文件</span></span></a></li><li><a class="level is-mobile" href="#模板文件替换输出"><span class="level-left"><span class="level-item">1.2.6</span><span class="level-item">模板文件替换输出</span></span></a></li></ul></li><li><a class="level is-mobile" href="#3、-小结"><span class="level-left"><span class="level-item">1.3</span><span class="level-item">3、 小结</span></span></a></li></ul></li><li><a class="level is-mobile" href="#二、best-cli解析"><span class="level-left"><span class="level-item">2</span><span class="level-item">二、best-cli解析</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#1、支持指令"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">1、支持指令</span></span></a></li><li><a class="level is-mobile" href="#2、常用指令解析"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">2、常用指令解析</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#init"><span class="level-left"><span class="level-item">2.2.1</span><span class="level-item">init</span></span></a></li><li><a class="level is-mobile" href="#copy"><span class="level-left"><span class="level-item">2.2.2</span><span class="level-item">copy</span></span></a></li><li><a class="level is-mobile" href="#copymodule"><span class="level-left"><span class="level-item">2.2.3</span><span class="level-item">copymodule</span></span></a></li></ul></li></ul></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/%E5%89%8D%E7%AB%AF/"><span class="level-start"><span class="level-item">前端</span></span><span class="level-end"><span class="level-item tag">9</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E5%89%8D%E7%AB%AF/JavaScript/"><span class="level-start"><span class="level-item">JavaScript</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%89%8D%E7%AB%AF/ThreeJs/"><span class="level-start"><span class="level-item">ThreeJs</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%89%8D%E7%AB%AF/node/"><span class="level-start"><span class="level-item">node</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%89%8D%E7%AB%AF/typeScript/"><span class="level-start"><span class="level-item">typeScript</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%89%8D%E7%AB%AF/%E6%A1%86%E6%9E%B6/"><span class="level-start"><span class="level-item">框架</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/%E9%9F%B3%E4%B9%90/"><span class="level-start"><span class="level-item">音乐</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/JavaScript/"><span class="tag">JavaScript</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ThreeJs/"><span class="tag">ThreeJs</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/music/"><span class="tag">music</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/node/"><span class="tag">node</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/typeScript/"><span class="tag">typeScript</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%A1%86%E6%9E%B6/"><span class="tag">框架</span><span class="tag">2</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="Cynqu" height="28"></a><p class="is-size-7"><span>&copy; 2021 Cynqu</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>